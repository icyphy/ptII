<!-- $Id$ -->
<html>
<head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<title>Ptolemy II FAQ</title>
<link href="default.css" rel="stylesheet" type="text/css">
</head>
<body>
 <!--  Note that if you include hyperlink, be sure to 
       include URL in the text so that we can have a text only version.

       By default, this file is found on the web at
       http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIfaq.htm	
       This file appears in each Ptolemy II release as $PTII/doc/ptIIfaq.htm

       Rather than editing ptweb/ptolemyII/ptIIfaq.htm directly, instead
       edit ptII/doc/ptIIfaq.htm and then copy into the ptweb cvs repository:
	# Edit ptII/doc/ptIIfaq.htm
	cp ptII/doc/ptIIfaq.htm ptweb/ptolemyII/ptIIfaq.htm
	cd ptweb/ptolemyII
	cvs commit -m "Updated faq in ptII Tree" ptIIfaq.htm
       Then update the Public website, see:
        http://chess.eecs.berkeley.edu/ptolemy/group/public.htm
 -->

<h1>Ptolemy II Frequently Asked Questions</h1>
This FAQ can be found at:
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIfaq.htm"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIfaq.htm</CODE></a>
 <br>The version of this FAQ is: $Id$

<menu>
<li> <a href="#General Questions"><b>1. General</b></a>
	<menu>
	<li> <a href="#ptolemy II description"><b>1.1 What is Ptolemy II?</b></a>
	<li> <a href="#ptolemy II copyright"><b>1.2 What is the copyright?</b></a>
	<li> <a href="#mailing list"><b>1.3 Is there a mailing list?</b></a>
	</menu>

<li> <a href="#Relationship with other packages"><b>2. Relationship with other packages</b></a>
	<menu>
	<li> <a href="#ptolemy classic"><b>2.1 What about compatibility with Ptolemy Classic (Ptolemy 0.7.x)?</b></a>

	<li> <a href="#simulink"><b>2.2 How are Ptolemy II and Matlab/Simulink different?</b></a>

	<li> <a href="#metropolis"><b>2.3 What is the relationship between Ptolemy and Metropolis?</b></a>
	</menu>

<li> <a href="#ptolemy II faq: installation"><b>3. Installation questions</b></a>
	<menu>
	<li> <a href="#downloading Ptolemy II"><b>3.1 How do I download
	Ptolemy II?</b></a>

	<li> <a href="#platforms that Ptolemy II runs under"><b>3.2 What
	platforms does Ptolemy II run under?</b></a>

	<li> <a href="#ptolemy II installation, what do I need"><b>3.3 What do I need to Install Ptolemy II?</b></a>
	</menu> 

<li> <a href="#ptolemy II faq: using Ptolemy II"><b>4. Using Ptolemy II</b></a>
	<menu>
	<li> <a href="#invoking Ptolemy II?"><b>4.1 How do I invoke Ptolemy II?</b></a>
	<li> <a href="#reading data from files?"><b>4.2 How do I read data from a file?</b></a>
	</menu>

<li> <a href="#ptolemy II faq: extending"><b>5. Extending Ptolemy II</b></a>
	<menu>
	<li> <a href="#Adding actors"><b>5.1 How do I add an actor?</b></a>


	<li> <a name="#PolymorphicActors"><b>5.2 What makes an actor domain polymorphic?</b></a>

	<li> <a href="#Interfacing to C/C++"><b>5.3 How do I interface to C/C++</b></a>

	<li> <a href="#Customizing the GUI"><b>5.4 How do I customize the GUI?</b></a>
	<li> <a href="#MoML"><b>5.5 What file format are the models stored in?</b></a>
	<li> <a href="#Scripting"><b>5.6 Is there a scripting interface to Ptolemy II?</b></a>
	<li> <a href="#Contributions"><b>5.7 Does the Ptolemy project take software contributions?</b></a>
	</menu>

</menu>

<h2><a name="General Questions"><b>1. General</b></a></h2>
<dl>

<dt> <a name="ptolemy II description"><b>1.1 What is Ptolemy II?</b></a>
<dd> 
<p>
Ptolemy II is a software framework developed as part of the Ptolemy project.
It is a Java-based component assembly framework with a graphical
user interface called Vergil.  Vergil itself is a component assembly
defined in Ptolemy II.
</p>
<p>
The Ptolemy project studies modeling, simulation, and design of
concurrent, real-time, embedded systems. The focus is on assembly of
concurrent components. The key underlying principle in the project is
the use of well-defined <i>models of computation</i> that govern the
interactions between components. A major problem area being addressed is
the use of heterogeneous mixtures of models of computation.
</p>
<p>
 <!-- For clarity, we do not always display the URL here   -->

The Ptolemy Project 
(<a href="http://ptolemy.eecs.berkeley.edu/index.html" target="_top"><CODE>http://ptolemy.eecs.berkeley.edu</CODE></a>)

contains much more information about the
project. The work is conducted in the


<a href="http://www.eecs.berkeley.edu/" target="_top">Department of Electrical Engineering and Computer Sciences</a>
of the
<a href="http://www.berkeley.edu/" target="_top">University of California at Berkeley</a>.
The project is directed by
Prof. Edward A. Lee 
(<a href="http://ptolemy.eecs.berkeley.edu/~eal/index.html" target="_top"><CODE>http://ptolemy.eecs.berkeley.edu/~eal</CODE></a>)

The project is named after
<a href="http://ptolemy.eecs.berkeley.edu/people/ptolemy.htm" target="_top">Claudius Ptolemaeus</a>,
the second century Greek astronomer, mathematician, and geographer.
</p>

<dt> <a name="ptolemy II copyright"><b>1.2 What is the copyright?</b></a>
<DD> Ptolemy II is released under the fairly liberal UC Berkeley copyright,

see 
<a href="http://ptolemy.eecs.berkeley.edu/ptIIcopyright.htm"><code>http://ptolemy.eecs.berkeley.edu/ptIIcopyright.htm</code></a>

Most files have the copyright at the top.

 <p>Ptolemy II is free for academic and commercial use.  You an incorporate it
into products, but you need to include follow the instructions in the
copyright notice.

 <p>This copyright is based on the Tcl copyright that was used when
Prof. Ousterhout was developing Tcl here at UC Berkeley.  This
copyright was also used in Ptolemy Classic, which has been used in
commercial products, see
<a href="http://ptolemy.eecs.berkeley.edu/archive/links.htm"><code>http://ptolemy.eecs.berkeley.edu/archive/links.htm</code></a>

<dt> <a name="mailing list"><b>1.3 Is there a mailing list?</b></a>
<DD> 
The Ptolemy mailing lists are run by the Majordomo mailing list 
server.  This server can automatically subscribe you to mailing
lists and it can send you monthly archive files for each of the
lists.  To find out more about our Majordomo sever, send an email
letter to: majordomo@ptolemy.eecs.berkeley.edu with the word "help"
in the body of the letter.

<dl>
<dt> Ptolemy Interest Mailing list
<dd> This moderated mailing list is for Ptolemy announcements only. Thus,
you cannot post to this group.  The amount of mail here is kept very
light (a few messages a year).

 <p>To subscribe to the ptolemy-interest mailing list, send mail to:
ptolemy-interest-request@ptolemy.eecs.berkeley.edu with the word
"subscribe" in the body (not the subject) of the letter.
 </p>
 <p>All mail to ptolemy-interest also goes to ptolemy-hackers, so if you
subscribe to ptolemy-hackers, there is no need to subscribe to
ptolemy-interest too.
 </p>

<dt>  Ptolemy Hackers Mailing list
<dd> This is a discussion list for Ptolemy questions, bug reports, and to
share Ptolemy additions and applications.  Since this is a discussion
group, mail volume can sometimes be heavy.  All mail sent to Ptolemy-
hackers is automatically cross posted to the comp.soft-sys.ptolemy
newsgroup.

 <p>To subscribe to the ptolemy-hackers mailing list, send mail to:
<a href="mailto:ptolemy-hackers-request@ptolemy.eecs.berkeley.edu"><CODE>ptolemy-hackers-request@ptolemy.eecs.berkeley.edu</CODE></a>
 with the word 
"subscribe" in the body of the letter.  To leave the newsgroup put
the word "unsubscribe" in the body of your message.
 </p>
</dl>

The best way to get questions answered is to subscribe to ptolemy-hackers
and then send email to that list.

 <p>Ptolemy is distributed without support or warranty.  However, if you
really need to contact a human being with a Ptolemy question, you can
send email to: ptolemy@eecs.berkeley.edu.

 <p> The Ptolemy Mailing lists and search engine can be found at
<a href="http://ptolemy.eecs.berkeley.edu/search/" target="_top"><CODE>http://ptolemy.eecs.berkeley.edu/search/</CODE></a>

</dl>


<h2><a name="Relationship with other packages"><b>2. Relationship with other packages</b></a></h2>
<dl>
<dt> <a name="ptolemy classic"><b>2.1 What about compatibility with Ptolemy Classic (Ptolemy 0.7.x)?</b></a>
<dd>
 <p>
This FAQ covers Ptolemy II.
The Ptolemy Classic FAQ can be found at  
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyclassic/ptolemy.faq"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyclassic/ptolemy.faq</CODE></a>
</p>

 <p>Ptolemy 0.x is fairly mature software in that the design is stable and
mostly unchanging. The Ptolemy II software system is under active development.

<menu>
<li> They are written in different languages (Java vs. C++)

<li> They have different file formats. Ptolemy 0.x uses Octtools,
Ptolemy II uses a system based on XML

<li> They have different user interfaces.  The Ptolemy II UI
is much easier to use than the Ptolemy Classic UI.
<li> Ptolemy Classic works best under Unix.  There is a 
Windows port of Ptolemy Classic, but it does not work well.
<br>Ptolemy II works under both Unix and Windows.
<li> Ptolemy Classic can generate code for various DSP primarily
using SDF semantics.
<br> Ptolemy II can generate code for non-hierarchical SDF models
and for hierarchical Giotto models.

</menu>
 <p>For more information about the current status of code generation in
Ptolemy II, see
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codegen.htm" target="_top"><code>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codegen.htm</code></a>
 </p>

<p>Various people have made efforts to use a different front end with
Ptolemy Classic.  See the
<a href="http://ptolemy.eecs.berkeley.edu/archive/"
target="_top">Ptolemy Website Links Page</a> for possible solutions,
including: 
<menu>

<li> <a href="http://www.mldesigner.com/news.html" target="_top">MLDesigner 2.1</a>
is a commercial product that was released in January 2002 and it
includes a conversion utility from Ptolemy Classic models.

<li> The 
<a href="" "http://peace.snu.ac.kr/research/peace/" target=_top">PeaCE</a> (Ptolemy extension as Codesign Environment)
might offer some ideas and does have some software available.

<li>The <a href="http://ptolemy.eecs.berkeley.edu/conferences/01/" target="_top">2001
Ptolemy Miniconference</a> had the following talk:


<p>
"An Approach to Executing Ptolemy Classic Models under Ptolemy II"
Ned Stoffel, Dwight Richards, Neil Smyth*, and Matt Goodman, Telcordia
Technologies, Inc. (* Smyth is now with Altio).

<p>The slides for this talk can be found at
<a href="http://ptolemy.eecs.berkeley.edu/conferences/01/src/miniconf/Telcordia.pdf" target="_top">http://ptolemy.eecs.berkeley.edu/conferences/01/src/miniconf/Telcordia.pdf</a>
<br>We are not sure if Telcordia has any software available for release.

</menu>

<dt> <a name="simulink"><b>2.2 How are Ptolemy II and Matlab/Simulink different?</b></a>
 <dd> 

     Ptolemy II has very little in common with Matlab, which is
     a textual, imperative, interactive, scientific programming
     language.  Ptolemy II works with Matlab, thanks to an interface
     developed by Zoltan Kemenczy and others at Research In Motion,
     Ltd.  See

<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/ptolemy/matlab/matlab.htm"><code>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/ptolemy/matlab/matlab.htm</code></a>


 <p>    Ptolemy II has much more in common with Simulink, which is
     a graphical block-diagram language, originally developed for
     control system design.  Simulink has a rich and expressive
     model of computation with continuous-time semantics and support
     for periodic discrete-time signals.  Some of its principles have
     been incorporated in the CT (continuous-time) domain of Ptolemy II,
     but not all.  The CT domain, for example, does not have the
     notion of "sample time" (which in Simulink provides the periodic
     discrete-time support) nor the support for algebraic loops.
     There is also currently no code generation support in CT
     (in Simulink, this is provided through the associated product
     Real-Time Workshop).  Also, the CT domain has implemented
     fewer ODE solvers than those provided by Simulink and has a
     smaller actor library.


 <p>     Ptolemy II and Simulink both support extension of the actor
     library through well-defined interfaces (in Simulink, this is
     called the S-function interface).  However, Ptolemy II is a more
     open architecture in that its infrastructure is open source,
     and the interfaces to the core mechanisms in the software
     are published and documented.  The persistent file format
     (MoML) is XML in Ptolemy II, which makes it both more verbose
     and more portable than the Simulink syntax (MDL files).
     Simulink supports one model of computation, whereas Ptolemy II
     supports several, and can be extended with new models of
     computation.  Simulink can also be extended, as for example
     it has been with the associated product Stateflow, which
     supports state-machine modeling. But in Simulink, the extension
     is done by defining new blocks using the S-function interface.
     As such, additional models of computation added this way are
     second class. For example, they cannot define the model of
     computation at the top level of the hierarchy, and cannot
     contain Simulink models within their own components.


<dt> <a name="metropolis"><b>2.3 What is the relationship between Ptolemy and Metropolis?</b></a>
 <dd> 


Ptolemy (<a href="http://ptolemy.eecs.berkeley.edu" target="_top"><CODE>http://ptolemy.eecs.berkeley.edu</CODE></a>)
and Metropolis (<a href="http://www.gigascale.org/metropolis/" target="_top"><CODE>http://www.gigascale.org/metropolis/</CODE></a>) 
are separate research projects at Berkeley,
albeit ones with considerable cross-influences. Ptolemy is headed by
<a href="http://ptolemy.eecs.berkeley.edu/~eal" target="_top">Edward Lee</a>,
while Metropolis is headed by 
<a href="http://www-cad.eecs.berkeley.edu/~alberto" target="_top">Alberto Sangiovanni-Vincentelli</a>.

 <br>A key principle in Metropolis is its "meta model," which in the
terminology of the Ptolemy project we would call its "abstract
semantics." In Metropolis, models consist of processes, with their own
thread of control, that communicate through ports and "media." The
media are roughly equivalent to Ptolemy Receivers; they define the
communication semantics between components. The abstract semantics of
Metropolis, is an abstraction of the model of computation that appears
in the Ptolemy PN and CSP domains. It is an abstraction because in
Metropolis, the communication semantics is not defined, whereas in PN
and CSP, it is (in two different ways). Metropolis model builders
construct the media that processes use to communicate. One could build,
for example, media in Metropolis to implement either PN or CSP.
Moreover, Metropolis model builders construct much of what would be the
director in a Ptolemy model.

 <p>In Ptolemy, two parts of the abstract semantics are separated, control
and communication. The abstract semantics of control is based on the
Executable interface. The abstract semantics of communication is based
on the IOPort/Receiver interface. The Metropolis metamodel is more
fixed about control semantics (i.e. components are process based), but
allows a richer interface to communications media (since a media can
expose arbitrary interfaces to components). This design choice makes
communication refinement easier (since the interface to a media can
change) but makes it more difficult to build domain-polymorphic
components since media often have different interfaces. It also
emphasizes process-oriented concurrency that often exists at the
top-level of a system, and de-emphasizes the construction of
hierarchical models.

 <p>The abstract semantics that binds most Ptolemy domains (with the
exception of PN and CSP) is significantly different. Instead of
processes, components are actors with three-phase firings. The
objective of this abstract semantics is to be able to define "domain
polymorphic" actors, which are actors that operate in several models of
computation. This enables hierarchically composing distinct models of
computation, since an aggregation of actors in one domain becomes an
actor in another. No such composition is possible (by any method we
know of) with processes. Indeed, both PN and CSP do not compose well
with other domains. There is no useful way to embed PN or CSP models
within other, firing-based models of computation.

 <p>A key reason for the choice of abstract semantics in Metropolis is the
desire to model several aspects of a system, including particularly its
performance when mapped to hardware resources. The separate threads of
control model parallel hardware systems well, and mesh well with trends
in hardware design.

 <p>Processes in Metropolis are defined in a Java-like syntax, and use a
model of computation in which components are processes with global
synchronization points. Constraints are an explicit, declarative manner
to specify requirements on performance (e.g. power or timing) and
sharing of computation and communication resources. For example, timing
constraints are expressed in linear temporal logic and timed logic. A
variety of back-ends have been built or are under construction, to
perform simulation, formal verification and synthesis, including ones
that target Java, SystemC, and C.

 <p>By contrast, in Ptolemy, actors are defined in ordinary Java. More
easily retargetted actor-definition languages are under development,
including Cal 
(<a href="http://www.gigascale.org/caltrop" target="_top"><CODE>http://www.gigascale.org/caltrop</CODE></a>).
and Actif
(<a href="http://www.gigascale.org/compose" target="_top"><CODE>http://www.gigascale.org/compose</CODE></a>).

 <p>One of the key innovations in Metropolis is the notion of "quantity
managers." Quantity managers contain code that is invoked when a
request is made to annotate a process transition with a quantity, such
as time, energy, or memory. Such requests are made, for example, on the
execution of a statement, or on a communication action over a medium. A
special case of quantity manager is the global time manager, which is
used to implement a discrete event semantics, where events are
processed in chronological order. Constraints in terms of quantities
are expressed formally in the Logic Of Constraints, a logic
particularly suitable for specifying constraints at the abstract system
level, where coordination of executions, not the low level interaction,
is of concern. LOC is a formalism designed to reason about simulation
traces. It consists of all the terms and operators allowed in
sentential logic, with additions that make it possible to specify
system level quantitative constraints.

 <p>In Ptolemy, quantity managers would be associated with the director,
although no director has been developed (to our knowledge) with such a
broadly applicable mechanism.


</dl>


<h2><a name="ptolemy II faq: installation"><b>3. Installation questions</b></a></h2>
<dl>
<dt> <a name="downloading Ptolemy II"><b>3.1 How do I download	Ptolemy II?</b></a>
<dd> Ptolemy II is available in several formats including applets, source code, a Windows installer and Web Start. 
For details, see
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/" target="_top"><code>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/</code></a>
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/"><code></code></a>

<dt> <a name="platforms that Ptolemy II runs under"><b>3.2 What platforms does Ptolemy II run under?</b></a>
<dd> Ptolemy II is written in Java, so it should run on any platform
that supports a recent Java Virtual machine.  Locally, we use
Windows XP and Windows 2000 with the Cygwin toolkit for development.
The nightly builds run under Solaris 8.  Some people in the group use Linux.

<dt> <a name="ptolemy II installation, what do I need"><b>3.3 What do I need to Install Ptolemy II?</b></a>
<dd> At the minimum, you need the Java Runtime Environment.
For details, see the installation pages at
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/" target="_top"><code>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/</code></a>
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/"><code></code></a>

</dl>


<h2><a name="ptolemy II faq: using Ptolemy II"><b>4. Using Ptolemy II</b></a></h2>

<dl>
<dt> <a name="invoking Ptolemy II?"><b>4.1 How do I invoke Ptolemy II?</b></a>
<dd> 
If you install Ptolemy II using the Windows installer, then
menu choices should be added to <CODE>Start</CODE> -&gt; 
<CODE>Programs</CODE> -&gt; <CODE>Ptolemy</CODE>.

 <p>
Ptolemy II models can be run from the command line, this is what we do
for the nightly test suite.
  <dl>

  <dt> <CODE>$PTII/bin/vergil foo.xml</CODE>
  <dd> will bring up a visual editor for the model defined in foo.xml.
  The visual editor allows you to change the model and run it.

  <dt> <CODE>$PTII/bin/ptolemy foo.xml</CODE>
  <dd> will bring up a run control panel for that model and allow you to run
  it

  <dt> <CODE>$PTII/bin/ptexecute foo.xml</CODE>
  <dd> will run the model.  The model need not be graphical.

  <dt> <CODE>java -classpath $PTII ptolemy.actor.gui.MoMLSimpleApplication foo.xml</CODE>
  <dd> will run the model without requiring a connection to a display.
  Use this method for running models as part of cron jobs etc.
  </dl>

 <p>If you want to start Vergil by hand, the answer depends on which
version of Ptolemy II you are using.

 <p>If you downloaded the source files and compiled them, then the
only jar file that might need to be included is diva.jar.  Releases 
<B>after</B> Ptolemy II 3.0.2 include the diva source files,
so in theory,
<pre>
java -classpath "$PTII" ptolemy.vergil.VergilApplication
</pre>
should work.
 <p>Under Windows with Cygwin with Ptolemy II 3.0.2 and earlier, try:
<pre>
java -classpath "$PTII;$PTII/lib/diva.jar" ptolemy.vergil.VergilApplication
</pre>

 <p>If you have chose the Windows Installer, then the individual
<CODE>.class</CODE> files have been placed in jar files

Vergil uses the following jar files
	<ul>
	<li> <CODE>./ptolemy/ptsupport.jar</CODE>
	<li> <CODE>./ptolemy/vergil/vergil.jar</CODE>
	<li> <CODE>./ptolemy/lib/diva.jar</CODE>
	<li> <CODE>./ptolemy/domains/domains.jar</CODE>
	<li> <CODE>./ptolemy/copernicus/copernicus.jar</CODE>
	</ul>
The directory where Ptolemy II is installed should also be in the classpath.

 <p>To start Vergil by hand in when the Ptolemy II was installed from
the Windows installer, try starting up by cd'ing to where the release
is installed and typing in the following (all on one line)

 <!-- Split this into multiple lines so that the display does not
have a horizontal scroll bar because of the length of the line. -->
<pre>
java -classpath ".;./ptolemy/ptsupport.jar;\
./ptolemy/vergil/vergil.jar;./lib/diva.jar;\
./ptolemy/copernicus/copernicus.jar;\
./ptolemy/domains/domains.jar"\
 ptolemy.vergil.VergilApplication
</pre>


<dt> <a name="reading data from files?"><b>4.2 How do I read data from a file?</b></a>
<dd> 

 <p>Actors that read and write data are visible in Vergil under 
<CODE>actor library</CODE> -&gt; <CODE>io</CODE>.

<p>When an actor takes a URL as an argument, use
<CODE>file:./<I>filename</I></CODE>.  For details, see the Ptolemy II 2.0.1
DoubleReader actor at
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/actor/lib/DoubleReader.html"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/actor/lib/DoubleReader.html</CODE></a>

 <p>Ptolemy II 3.0.2 includes
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/actor/lib/LineReader.html"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/actor/lib/LineReader.html</CODE></a> 
- Reads a file or URL, one line at a time, and outputs each line as a String.

 <p>Ptolemy II 3.0.2 also includes
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/actor/lib/ExpressionReader.html"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/actor/lib/ExpressionReader.html</CODE></a>
- Reads a file or URL, one line at a time, evaluates each line as an expression and outputs the tokens resulting from the evaluation.

 <p> These actors use a
 <p><a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/kernel/attribute/FileAttribute.html">FileAttribute</a>
to specifies a file or URL. (FileAttribute is new in Ptolemy II 3.0)
 <p>Actors that have Parameters may 
read data using the <CODE>readFile</CODE>, <CODE>findFile</CODE> and
<CODE>readMatrix</CODE> expression operators, see
<a
href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/expressions.htm"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/expressions.htm</CODE></a>
and
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/data/expr/UtilityFunctions.html"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/data/expr/UtilityFunctions.html</CODE></a>

 <p>The way to use readFile is as an expression:
<pre>
eval(readFile("foo.txt"))
</pre>
where foo.txt contains a single line that gets parsed as a Ptolemy
expression.  For example, if foo.txt contained
<pre>
{1.0, 2.0}
</pre>
Then the expression would resolve to an array of two elements, 1.0 and
2.0.

 <p>
ptII/ptolemy/data/expr/Constants.java defines PTII and HOME
as variables like PI and true.  PTII can be used in an expression
to refer to a file relative to the Ptolemy II installation directory.

 <p><CODE>PTII</CODE> is the value of the ptolemy.ptII.dir Java property,
which is set when vergil is invoked.

 <p><CODE>HOME</CODE> is the value of the user.dir property.  
Unsigned applets can read user.dir

 <p>The expression language includes the <CODE>property()</CODE>
 method that will read Java properties from the local environment.

 <p><CODE>property("ptolemy.ptII.dir")</CODE>
 is set to the value of $PTII when
vergil etc. are invoked. 

 <p>For example:
<pre>
property("ptolemy.ptII.dir") + "/ptolemy/actor/lib/test/auto/FileWriter1Output.txt"
</pre>

</dl>

<h2><a name="ptolemy II faq: extending"><b>5. Extending Ptolemy II</b></a></h2>
<dl>
<dt> <a name="Adding actors"><b>5.1 How do I add an actor?</b></a>
<dd> See the <code>Add Actor</code> link in
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/coding/index.htm" target="_top"><code>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/coding/</code></a>

<dt> <a name="PolymorphicActors"><b>5.2 What makes an actor domain polymorphic?</b></a>
<dd>
As for making actors domain polymorphic, the general rule we follow is:

<menu>
<li> return false in prefire() if there is insufficient input data to fire
<li> consume a token at each input if one is present in fire()
<li> produce outputs in fire()
<li> update the state of the actor in postfire(), not fire
</menu>


If more than one output token is produced on an output port or
consumed on an input port in fire(), then the input port should have a
tokenConsumptionRate parameter or the output port tokenProductionRate
Parameter indicating how many tokens are produced.  (To see sample
values, in the FIR actor, right click on the input or output port and
select configure).


 <p>If these rules are followed, then the actor will work in at least:

   DE, SDF, CT, PN, SR, CI

 <br>The most difficult of the rules to follow is updating the state only
in postfire(). This rule only matters in CT because CT may 
have to backtrack time

<dt> <a name="Interfacing to C/C++"><b>5.3 How do I interface to C/C++</b></a>
<dd>
Ptolemy II is written in Java, and Java has the Java Native Interface
(JNI), see
<a href="http://java.sun.com/j2se/1.4/docs/guide/jni/index.html" target="_top">Sun's JDK1.4 JNI Enhancements page at <CODE>http://java.sun.com/j2se/1.4/docs/guide/jni/index.html</CODE></a>.

 <p>Vincent Arnould and others at Thales have implemented a prototype
of an interface betwenn Ptolemy II actors and C code using the
Java Native Interface (JNI), see
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/jni/package-summary.html"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/jni/package-summary.html</CODE></a>
(This work is present in Ptolemy II 3.0)

 <p>Zoltan Kemenczy and others at Research In Motion, Ltd. developed an
interface to Matlab that uses JNI, see
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/ptolemy/matlab/matlab.htm"><code>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/ptolemy/matlab/matlab.htm</code></a>

 <p>Using JNI to interface to a C/C++ package on one platform is
fairly straightforward, but it can be difficult to configure the paths
that JNI in truly platform independent manner so that the same
code will work on multiple platforms.


<dt> <a name="Customizing the GUI"><b>5.4 How do I customize the GUI?</b></a>
<dd> 
Ptolemy II uses Diva to display block diagram editors.
 <br>Information about Diva can be found at
<a href="http://www.gigascale.org/diva" target="_top"><code>http://www.gigascale.org/diva</code></a>
Ptolemy II uses the notion of Tableaus to manage state for tools.
The Ptolemy II design document has a chapter that discusses the UI
API.

 <p>The code that brings up the JVM Properties window is a simple example,
the code is at
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/ptolemy/actor/gui/JVMTableau.java"><code>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/ptolemy/actor/gui/JVMTableau.java</code></a>
 <p>

 <!-- We can't reliably display .xml in a browser -->
<CODE>$PTII/ptolemy/configs/vergilConfiguration.xml</CODE>
adds this feature with this line:
<pre>
       &lt;property name="JVM Properties" 
                  class="ptolemy.actor.gui.JVMTableau$Factory"/&gt;
</pre>


<dt> <a name="MoML"><b>5.5 What file format are the models stored in?</b></a>
<dd> Ptolemy II stores models in an XML format called MoML.
The design doc covers MoML in detail.
 <p>The beauty of using a human readable (though verbose) file
format is that we can use standard tools like XSLT and sed to 
transform models.
	
<dt> <a name="Scripting"><b>5.6 Is there a scripting interface to Ptolemy II ?</b></a>

<dd> The PythonScript actor includes and interface to
<a href="http://www.jython.org/#in_browser" target="_top">Jython</a>,
a Java implementation of Python.  The PythonScript actor allows
the user to define an actor on the fly by defining the <CODE>fire()</CODE>
and other methods in Python.  Using an interpreted language in this context instead of defining actors in Java means that we need not recompile and restart
Ptolemy II to make a change to an actor.  The tradeoff is that 
a PythonScript actor will run more slowly than a similar actor implemented in 
Java.
 <br>For details, see
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/actor/lib/python/PythonScript.html"><CODE>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/codeDoc/ptolemy/actor/lib/python/PythonScript.html</CODE></a>

 <p>The Ptolemy II test suite uses Jacl, a Java implementation of Tcl
as a scripting language.  With Jacl, we can build and run models
using an interpreted scripting environment without compilation
and avoiding the usual edit/compile/run loop.

 <br>For details, see the Testing link in 
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/coding/index.htm" target="_top"><code>http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/coding/</code></a>
	



<dt> <a name="Contributions"><b>5.7 Does the Ptolemy project take software contributions?</b></a>
<dd> Yes, the Ptolemy project has a long history of folding in software
contributions from off site developers.

 <p> The most critical issue is that it is easiest if the copyright of
any contributed code uses the same wording as the standard Ptolemy II
copyright.  It is best if the Regents of the University of California
retain the copyright, but it is acceptable if the someone else retains
the copyright.

 <p>The second most critical issue is that the code follow the Ptolemy
coding convention.  Since we consider software releases a form of
publication, we expect code to be readable, which means that comments
have complete sentences, identifiers are complete words with embedded
capitalization and the source code has been spell checked.  For
details see the Ptolemy II coding style guide in
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/ptIIlatest/ptII/doc/coding/style.htm"><CODE>$PTII/ptolemy/doc/coding/style.htm</CODE></a>
and in the first few chapters of the
<a href="http://ptolemy.eecs.berkeley.edu/ptolemyII/designdoc.htm">Ptolemy II Design Document</a>.

 <p>It is best if contributed code has a few small, concise examples
illustrating its use, and includes models that can be run as part of
the test suite.  These models usually reside in a
<CODE>test/auto/</CODE> directory and do not use the an graphical
actors so that they can be run as part of the nightly build.

<p>If you have code that you would like to contribute, please email <a
href="mailto:ptolemy@eecs.berkeley.edu"><CODE>ptolemy@eecs.berkeley.edu</CODE></a>
with a description of your code.

</dl>

</menu>

<p><font size="2" color="#cc0000">Last Updated: $Date$</font>
</body>
</html>
