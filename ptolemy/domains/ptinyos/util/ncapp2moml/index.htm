<!-- $Id$ -->
<html>
  <head>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
    <title>ncapp2moml</title>
  </head>
  <body>
    <h1>ncapp2moml</h1> 

    <p> <a href="http://www.tinyos.net#in_browser" target="_top">TinyOS</a> is an
    event-driven operating system designed for sensor network nodes
    that have very limited resources (e.g., 8K bytes of program
    memory, 512 bytes of RAM).  TinyOS, is used, for example, on the
    Berkeley MICA motes, which are small wireless sensor nodes.  <a
    href="httP://nescc.sourceforge.net#in_browser" target="_top">nesC</a> is an
    extension to the C programming language designed to embody the
    structuring concepts and execution model of TinyOS.

    <p>ncapp2moml is used to convert nesC application files (.nc) into
    <a
    href="http://ptolemy.eecs.berkeley.edu/publications/papers/00/moml#in_browser"
    target="_top">MoML</a> (.moml) files.  This will create Ptolemy II
    models that you can run in Viptos.  You must setup the necessary
    MoML library of nesC components with the <a
    href="../nc2moml/index.htm">nc2moml</a> tool before you can successfully
    open files made with this ncapp2moml tool.

    <h2>Installation instructions</h2>

    <p><BLOCKQUOTE>
	<B>Note: You must follow the instructions <a
	href="../nc2moml/index.htm">here</a> for running the nc2moml
	tool before you can use models generated with this ncapp2moml
	tool.</B>
    </BLOCKQUOTE>

    <p><BLOCKQUOTE>
	<B>Note: As of 10/05, Windows users will not be able
       to run TinyOS models inside Ptolemy.</B>
	The reason is that reloading the TinyOS shared objects
	into the running Ptolemy interface fails because the
	TinyOS shared objects use pthreads and under Windows, Java
	is using Windows native threads.  We are working on a
	solution.  In the interim, Windows users can convert 
	.nc files to .moml files and create models, but running
	the model fails.
    </BLOCKQUOTE>

    <ol>
      <li> Run the script to generate the .moml files from the .nc files.
        <pre>
cd $PTII/ptolemy/domains/ptinyos/util/ncapp2moml
./ncapp2moml
        </pre>
	The <CODE>ncapp2moml</CODE> command will take a few minutes to complete.

        <p> Note: The ncapp2moml tool requires that you build the tools in <CODE>$PTII/bin</CODE>.  Do the following and rerun the script above if they are missing:
        <pre>
cd $PTII/bin
make
        </pre>
      <li> See if it worked:
        <ol> 
          <li> You should see some valid MoML code in:
            <pre>$PTII/vendors/ptinyos/momlapp</pre>
            <br>
            The directory structure should reflect that of the TinyOS
            directory structure.

          <li> 
            <ol>
              <li>Try running Viptos:
                <pre>$PTII/bin/vergil -viptos</pre>

              <li>Open a demo by going to File -&gt; Open File, and
              opening file
              <CODE>$PTII/vendors/ptinyos/momlapp/apps/CntToLeds/CntToLeds.moml</CODE>
              or
              <CODE>$PTII/vendors/ptinyos/momlapp/apps/CntToLeds/CntToLeds-InWireless.moml</CODE>
              (only one of these will have been generated, depending
              on what options were used in running ncapp2moml).

              <li>
                <ul>
                  <li>If you opened CntToLeds.moml, you may wish to
                  run the automatic graph layout by selecting Graph -&gt;
                  Automatic Layout form the menu, or by typing Ctrl-T.
                  <li>If you opened CntToLeds-InWireless.moml, you
                  have to first right-click on the MicaBoard and
                  select Look Inside, then right-click on the
                  MicaActor and select Look Inside.  Then, you can run
                  the automatic graph layout by selecting Graph -&gt;
                  Automatic Layout form the menu, or by typing Ctrl-T.
                </ul>

              <li>Try to open a demo that uses the components original
              source directory.  Go to File -&gt; Open File, and open file
              <CODE>$PTII/vendors/ptinyos/momlapp/apps/Blink/Blink.moml</CODE>
		 or
              <CODE>$PTII/vendors/ptinyos/momlapp/apps/Blink/Blink-InWireless.moml</CODE>
              (only one of these will have been generated, depending
              on what options were used in running ncapp2moml.
            </ol>
        </ol>
    </ol>


</body>
</html>
